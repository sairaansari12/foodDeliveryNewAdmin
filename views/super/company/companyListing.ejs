<!DOCTYPE html>
<html lang="en">
<%- include('../partials/header'); -%>

<body class="loading">
    <!-- Begin page -->
    <div id="wrapper">
        <%- include('../partials/dashboardHeader'); -%>
        <div class="content-page">
            <div class="content">
                <!-- Start Content-->
                <div class="container-fluid">
                    <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box">
                                    <div class="page-title-right">
                                        <ol class="breadcrumb m-0">
                                            <li class="breadcrumb-item"><a href="javascript: void(0);">Dashboard</a></li>
                                            <li class="breadcrumb-item"><a href="javascript: void(0);">Companies</a></li>
                                        </ol>
                                    </div>
                                    <h4 class="page-title">Companies</h4>
                                </div>
                            </div>
                        </div>     
                        <!-- end page title --> 


                        <div class="row">
                            <div class="col-12">
                                <div class="card-box">
                                    <div class="row">
                                        <!-- <div class="col-lg-8">
                                            <form class="form-inline">
                                                <div class="form-group">
                                                    <label for="inputPassword2" class="sr-only">Search</label>
                                                    <input type="search" class="form-control" id="inputPassword2" placeholder="Search...">
                                                </div>
                                                <div class="form-group mx-sm-3">
                                                    <label for="status-select" class="mr-2">Sort By</label>
                                                    <select class="custom-select" id="status-select">
                                                        <option>Select</option>
                                                        <option>Date</option>
                                                        <option selected>Name</option>
                                                        <option>Revenue</option>
                                                        <option>Employees</option>
                                                    </select>
                                                </div>
                                            </form>
                                        </div> -->
                                        <div class="col-lg-12">
                                            <div class="text-lg-right mt-3 mt-lg-0">
                                                <a href="<%- superadminpath %>company/add"><button type="button" class="btn btn-danger waves-effect waves-light mr-1"><i class="mdi mdi-plus-circle mr-1"></i> Add New</button></a>
                                            </div>
                                        </div><!-- end col-->
                                    </div> <!-- end row -->
                                </div> <!-- end card-box -->
                            </div><!-- end col-->
                        </div>
                        <!-- end row -->    
                    <!-- end row -->
                    <%-include ('../partials/flashMessage')%>
                    <% 
if(data==undefined || data==null || data=='{}' || data.length==0) {%>

                    <%-include ('../partials/norecord')%>


                    <%}else {%>

                    <div class="row">
                        <%for(var t=0;t<data.length;t++) {%>
                        <div class="col-lg-4">
                                <div class="card-box bg-pattern">
                                    <div class="text-center">
                                        <% if (! data[t].logo1) { %>
                                        <img src="/dist/assets/images/users/user-1.jpg" class="rounded-circle img-thumbnail avatar-xl">
                                         <% }else { %>
                                        <img src="<%-data[t].logo1 %>" alt="logo" class="avatar-xl rounded-circle mb-3">
                                        <% } %>
                                        <h4 class="mb-1 font-20"><%-data[t].companyName %></h4>
                                        <p class="text-muted  font-14"><%-data[t].address1 %></p>
                                    </div>

                                    <p class="font-14 text-center text-muted">
                                        <%-data[t].email %> , <%-data[t].countryCode %><%-data[t].phoneNumber %>
                                    </p>

                                    <div class="text-center">
                                        <a href="<%-superadminpath%>company/view/<%= data[t].id %>" class="btn btn-sm btn-light">Update</a>
                                        <a class="btn btn-sm btn-danger"
                                                href="javascript:;" <%if(data[t].status==0){%> style="display:none"
                                                <%}%>  id="block_status_<%-data[t].id%>"
                                                onclick="StatusChange('<%= data[t].id %>','1')" class="btn small  bg-green  ">
                                                Block</a>
                                        <a class="btn btn-sm btn-success"
                                            href="javascript:;" <%if(data[t].status==1){%> style="display:none"
                                            <%}%>  id="unblock_status_<%-data[t].id%>"
                                            onclick="StatusChange('<%= data[t].id %>','0')" class="btn small  bg-red  ">
                                            Unblock</a>
                                    </div>

                                    <div class="row mt-4 text-center">
                                        <div class="col-6">
                                            <h5 class="font-weight-normal text-muted">Number of Orders</h5>
                                            <h4><%- data[t].totalOrders %></h4>
                                        </div>
                                        <div class="col-6">
                                            <h5 class="font-weight-normal text-muted">Tags</h5>
                                            <h4><%- data[t].tags %></h4>
                                        </div>
                                    </div>
                                </div> <!-- end card-box -->
                            </div><!-- end col -->


                        <%}%> </div>
                                        <%}%>

                        <!-- end row -->



                    </div> <!-- container -->

                </div> <!-- content -->

            </div>

            <!-- ============================================================== -->
            <!-- End Page content -->
            <!-- ============================================================== -->


        </div>
        <!-- END wrapper -->
        <%- include('../partials/script'); -%>
          <%- include('../partials/commonJs'); -%>
</body>

</html>


<script>
    $('#search').on('keyup', function () {
        console.log('search>>>>');
        setTimeout(function () { getSearch(1) }, 800);
    });


    function StatusChange(id, status) {

        var confirm1 = (status == "1") ? "Block" : "Unblock"
        if (confirm('Are you sure you want to ' + confirm1 + ' this?')) {
            $.ajax({
                type: 'POST',
                url: '<%-superadminpath %>company/status',
                dataType: 'json',
                data: { 'id': id, 'status': status },
                success: function (response) {
                    if (response.code == '200') {
                        // $('#block_status_'+id).html('');

                        if (status == "1") {
                            $('#block_status_' + id).hide()
                            $('#unblock_status_' + id).show()
                            showToastSuccess("Company blocked successfully")
                        } else {
                            $('#block_status_' + id).show();
                            $('#unblock_status_' + id).hide();
                            showToastSuccess("Company active successfully");
                        }

                    }
                    else {

                        showToastError(response.message)
                    }
                },

                error: function (response) {
                    showToastError(response.message)

                }
            });
        }
    }




    function getSearch(currentPage) {
        currentPage = currentPage
        var search = $('#search').val()
        var limit = 40
        $('#loading1').show()
        var status = $('#status').val();

        //alert(fromDate)
        $.ajax({
            type: 'POST',
            url: '<%-adminpath%>employees/search',
            dataType: 'json',
            data: { 'search': search, 'page': currentPage, 'limit': limit },
            success: function (response) {
                $('#loading1').hide()
                console.log('response>>>>>>>>>>>',response);

                // if (response.code == '200') {
                //     var row = "";
                //     console.log(response)
                //     $('#orderData').html('')
                //     var data1 = response.body.data
                //     var data = response.body.data.rows
                //     for (var t = 0; t < data.length; t++) {


                //         var status = "Pending"
                //         var Payment = "Failed"
                //         var paymentBg = "bg-red"
                //         if (data[t].progressStatus == "1") status = "Confirmed"
                //         if (data[t].progressStatus == "2") status = "Cancelled"
                //         if (data[t].progressStatus == "3") status = "Processing"
                //         if (data[t].progressStatus == "4") status = "Cancelled-Comapny"
                //         if (data[t].progressStatus == "5") status = "Completed"

                //         var btnBg = getOrderColor(data[t].progressStatus)
                //         if (data[t].payment && data[t].payment.transactionStatus == "1") {
                //             Payment = "Success"
                //             paymentBg = "bg-green"
                //         }


                //         row = row + '<tr id="row_' + data[t].id + '">' +
                //             '			<td>' + data[t].orderNo + ' </td>' +
                //             '			<td>' + data[t].user.firstName + " " + data[t].user.lastName + ' </td>' +
                //             '			<td>' + format(new Date(data[t].serviceDateTime)) + ' </td>' +
                //             '            <td>' + data[t].user.countryCode + " " + data[t].user.phoneNumber + '</td>' +
                //             '            <td>' + data[t].totalOrderPrice + '</td>' +
                //             '            <td>' +
                //             '             <a href="javascript:;"  class="btn ' + paymentBg + ' font-size-10 pad5A tooltip-button" data-placement="bottom" title="Open modal window"   >' +
                //             '                <span class="button-content">' +
                //             '                    <i class="glyph-icon icon-money float-left"></i>' +
                //             '<span>' + Payment + ' <span>' +
                //             '                </span>' +
                //             '            </a></td>' +
                //             '            <td>' + (data[t].address != null ? data[t].address.houseNo + " " + data[t].address.addressName + " ," + data[t].address.city : "") + '</td>' +
                //             '            <td>' + format(new Date(data[t].createdAt)) + '</td>              ' +
                //             '              ' +
                //             '            <td>' +
                //             '             <a href="javascript:;"  class="btn ' + btnBg + ' font-size-10 pad5A tooltip-button  black-modal-60" data-placement="bottom" title="Open modal window"  id="block_status_' + data[t].id + '"  onclick="showModal(\'' + data[t].id + '\',\'' + data[t].progressStatus + '\')" >' +
                //             '                <input type="hidden"  value="' + data[t].progressStatus + '" id="block_statusvalue_' + data[t].id + '">' +
                //             '                <span class="button-content">' +
                //             '                    <i class="glyph-icon icon-cog float-left"></i>' +
                //             '<span id="block_statustext_' + data[t].id + '">' + status + ' <span>' +
                //             '                </span>' +
                //             '            </a>' +
                //             '             <div class="dropdown">' +
                //             '                <a href="javascript:;" title="" class="btn small bg-blue dropdown-toggle" data-toggle="dropdown">' +
                //             '                    <span class="button-content">' +
                //             '                        <i class="glyph-icon font-size-11 icon-cog"></i>' +
                //             '                        <i class="glyph-icon font-size-11 icon-chevron-down"></i>' +
                //             '                    </span>' +
                //             '                </a>' +
                //             '                <ul class="dropdown-menu float-right">' +
                //             '                    <li>' +
                //             '                        <a href="<%-adminpath%>orders/view/' + data[t].id + '" title="">' +
                //             '                            <i class="glyph-icon icon-edit mrg5R"></i>' +
                //             '                            View' +
                //             '                        </a>' +
                //             '                    </li>' +
                //             '                    <li class="divider"></li>' +
                //             '                    <li>' +
                //             '                        <a onclick="return confirm(\'Are you sure you want to delete this?\');"  href="<%-adminpath%>orders/delete/' + data[t].id + '" data-id="' + data[t].id + '" class="font-red" title="">' +
                //             '                            <i class="glyph-icon icon-archive mrg5R"></i>' +
                //             '                            Delete' +
                //             '                        </a>' +
                //             '                    </li>' +
                //             '                </ul>' +
                //             '            </div>' +
                //             '            </td>		' +
                //             '        </tr>';

                //     }

                //     if (row == "") {
                //         $('#orderData').html('&nbsp;&nbsp;&nbsp;No matching records found')

                //     }
                //     else $('#orderData').html(row);
                //     appendPagination(currentPage, Math.ceil(data1.count / limit))
                //     appendStat(response.body.counts)

                // }
                // else {

                //     showToastError(response.message)
                // }
            },

            error: function (response) {
                $('#loading1').hide()
                console.log('else response>>>',response);

                // showToastError(response.message)

            }
        });
    }
</script>