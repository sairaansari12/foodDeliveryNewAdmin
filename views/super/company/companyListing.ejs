<!DOCTYPE html>
<html lang="en">
<%- include('../partials/header'); -%>
<style type="text/css">
.car-dekho-main .car-dekho-main-head-inner {
    width: 100%;
    background: #fff;
     font-size: 16px;
    font-weight: 600;
    text-align: center;
    vertical-align: middle;
    padding: 15px;
    border-bottom: 1px solid #ddd;
        display: flex;
    align-items: center;
    min-height: 104px;
    justify-content: center;

}
.car-dekho-main-border {
     border: 1px solid #ddd;
     box-shadow: 0px 0px 2px 0px rgba(0,0,0,0.2);
}
.car-dekho-main-head-inner  img {
    max-width: 110px;
    display: inline-block;
    margin-left: 8px;
}
.car-dekho-main-border .car-dekho-main-body-inner {
    font-size: 14px;
    color: #333;
    text-align: center;
    vertical-align: middle;
    width: 100%;
    padding: 15px;
    border-bottom: 1px solid #ddd;
    height: 55px;
}
.car-dekho-main-body-inner:nth-child(even){
    background: #f5f5f5;
}
.car-dekho-main-head, .car-dekho-main-body {
    display: flex;
    flex-wrap: wrap;
    width: 100%;
    align-items: center;
    border-bottom: 1px solid #ddd;
    background: #fff;
}
.car-dekho-main-head, .car-dekho-main-body .car-dekho-main-body-inner:nth-child(1) {
    border-right: 1px solid #ddd;
}
.car-dekho-main-border-inner {
    width: 25%;
}
.car-dekho-main-border {
    display: flex;
    flex-wrap: wrap;
}
</style>
<body class="loading">
    <!-- Begin page -->
    <div id="wrapper">
        <%- include('../partials/dashboardHeader'); -%>
        <div class="content-page">
            <div class="content">
                <!-- Start Content-->
                <div class="container-fluid">
                    <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box">
                                    <div class="page-title-right">
                                        <ol class="breadcrumb m-0">
                                            <li class="breadcrumb-item"><a href="javascript: void(0);">Dashboard</a></li>
                                            <li class="breadcrumb-item"><a href="javascript: void(0);">Restaurants</a></li>
                                        </ol>
                                    </div>
                                    <h4 class=form-label">Restaurants</h4>
                                </div>
                            </div>
                        </div>     
                        <!-- end page title --> 



                        <div class="row">
                            <div class="col-12">
                                    
                               
                                <div class="card-box">
                                 
                                    <div class="row">
    
                                        
                                        <div class="col-lg-12">
                                            <form  onkeypress="return event.keyCode != 13" class="form-inline">
                                                <div class="form-group">
                                                    <label for="inputPassword2" class="sr-only">Search</label>
                                                    <input type="search" class="form-control" id="search" placeholder="Search...">
                                                </div>
                                                <div class="form-group mx-sm-2">
                                                    <label for="status-select" class="mr-2">Sort By</label>
                                                    <select onchange="sorting()" class="custom-select" id="sortby-select">
                                                        <option value="createdAt#DESC">All</option>
                                                        <option value="createdAt#DESC">Recently Added</option>
                                                        <option value="createdAt#ASC">Older to New</option>
                                                        <option value="totalOrders#DESC">High Orders</option>
                                                        <option value="totalOrders#ASC">Low Orders</option>
                                                        <option value="rating#DESC">High Rating</option>
                                                        <option value="rating#ASC">Low Rating</option>
                                                    </select>
                                                </div>
    
                                                <div class="form-group mx-sm-2">
                                                    <label for="status-select" class="mr-2">Status</label>
                                                    <select onchange="itemTypeFilter()" class="custom-select" id="itemtype-select">
                                                        <option value="">All</option>
                                                        <option value="0">Inactive</option>
                                                        <option value="1">Active</option>
                                                       
    
                                                    </select>
                                                </div>
    
                                                <div class="form-group mx-sm-4">
                                                    <input type="hidden" name="selectCompany" value="" id="selectCompany">
                                                    <div class="text-lg-right mt-3 mt-lg-0">
                                                        <a href="javascript:;" onclick="compareCompany()"><button type="button" class="btn btn-info waves-effect waves-light mr-1" >Compare Restaurants</button></a>
                                                        <a href="<%- superadminpath %>company/add"><button type="button" class="btn btn-danger waves-effect waves-light mr-1"><i class="mdi mdi-plus-circle mr-1"></i> Add New</button></a>
                                                    </div>
                                                </div><!-- end col--> 



                                            </form>
                                        </div>
                                      
                                    </div> <!-- end row -->
                                </div> <!-- end card-box -->
                            </div> <!-- end col-->
                        </div>
                 
                        <!-- end row -->    
                    <!-- end row -->
                    <%-include ('../partials/flashMessage')%>
                   

                    <div class="row" id="appendData">
                       

                        </div>
                        <div class="row">
                            <div class="col-12" id="append_pagination">
                        </div>
                                       
                        <!-- end row -->



                    </div> <!-- container -->

                </div> <!-- content -->

            </div>

            <!-- ============================================================== -->
            <!-- End Page content -->
            <!-- ============================================================== -->


     
   
    
        <!-- Long Content Scroll Modal -->
                                       <!-- Full width modal content -->
                                        <div id="full-width-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="fullWidthModalLabel" aria-hidden="true">
                                            <div class="modal-dialog modal-full-width">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h4 class="modal-title" id="fullWidthModalLabel">Compare Restaurants</h4>
                                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                    </div>
                                                    <div class="modal-body">
                                                         <div class="car-dekho-main">
                                                        <div class="container">
                                                            
                                                        </div>
                                                     </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-light" data-dismiss="modal">Close</button>
                                                        
                                                    </div>
                                                </div><!-- /.modal-content -->
                                            </div><!-- /.modal-dialog -->
                                        </div><!-- /.modal -->
        <!-- END wrapper -->


        <%- include('../partials/script'); -%>
        <%- include('../partials/commonJs'); -%>
    
    
</body>

</html>


<script>
   
   var currentPage=1
  var orderByInfo={'orderby':'createdAt',orderType:'DESC'}
 var status= ""

   $('#search').on( 'keyup', function (event) {
    event.preventDefault();

    if (event.keyCode === 13) {
     getFilter(1)
    } 
       
    });


    $(document).on('click', '.checkbox', function(){
        var favorite = [];
        $.each($("input[name='compare']:checked"), function(){
            favorite.push($(this).val());
        });
        if(favorite.length > 3)
        {
            showToastError("Sorry! Maximum three restaurants are allowed to compare!");
            return false;
        }
        $('#selectCompany').val(favorite);
        
    });

    
function getFilter(page)
{
        currentPage=page
        var page=1
        var limit=20

            var search = $('#search').val();
            $('#loading1').show()
                $.ajax({
                    url: '<%=superadminpath %>company/list',
                    type: 'POST',
                    data: {search: search,'orderByInfo':orderByInfo,'page':currentPage,'limit':limit,"status":status},
                    success: function(data){
                        $('#loading1').hide()
                        var html=""

                        if(data.code=="200")
                        {
                            
                       var obj=data.body.rows
                        $.each(obj,function(key,value){
                            
                
                         var ratings=getRating(value.rating)
                         var status=(value.status)==0?'Inactive':  'Active';
                         var statusClas=(value.status)==0?' bg-soft-danger': ' bg-soft-success';



                         html=html+ `<div class="col-lg-4">
                                <div class="card-box  product-box bg-pattern">

                                    <div class="product-action">

                                    <a href="<%-superadminpath%>company/permissions?id=${value.id}"  class="btn btn-success btn-xs waves-effect waves-light"><i class="mdi mdi-cog"></i>&nbsp;Permissions</a>
                                    <a href="javascript: void(0);"   onclick="deleteComp('${value.id}')" class="btn btn-danger btn-xs waves-effect waves-light"><i class="mdi mdi-close"></i>&nbsp;Delete</a>
                                </div>




                                    <input type="checkbox" name="compare"  value="${value.id}" class="checkbox" id="compare"><span style="margin-left: 5px;">Add to Compare</span>
                                    <div class="text-center">
                                       
                                        <img src="${value.logo1}"  onError="this.onerror=null;this.src='/assets/images/products/no-image.jpg';"  alt="logo" class="avatar-xl rounded-circle mb-3">
                                        
                                        <h4 class="mb-1 font-20">${value.companyName}</h4>
                                        <div class="text-warning mb-1 font-13">
                                                <a href="javascript:void(0)">${ratings}</a>
                                            </div>
                                        <p class="text-muted  font-14">${value.address1}</p>
                                    </div>

                                    <p class="font-14 text-center text-muted">
                                        ${value.email}, ${value.countryCode}${value.phoneNumber}
                                    </p>

                                    <div class="text-center">
                                        <a href="<%-superadminpath%>company/view/${value.id}" class="btn btn-sm btn-light">Update</a>
                                        
                                        <a class="btn btn-sm ${statusClas}"
                                            href="javascript:;"
                                              id="status_${value.id}"
                                            onclick="statusChange('${value.id}','${value.status}')">
                                            ${status}</a>
                                    </div>

                                    <div class="row mt-4 text-center">
                                        <div class="col-6">
                                            <h5 class="font-weight-normal text-muted">Number of Orders</h5>
                                            <h4>${value.totalOrders}</h4>
                                        </div>
                                        <div class="col-6">
                                            <h5 class="font-weight-normal text-muted">Tags</h5>
                                            <h5>${value.tags}</h5>
                                        </div>
                                    </div>
                                </div> 
                            </div>`

                          



                         

                        });
                       if(html=="") html="<h5 class='m-4'><span class='text-dark text-center'>No items in list</span></h5>";
                        $("#appendData").html(html);
                        appendPagination(currentPage,Math.ceil(data.body.count/limit))



                    }
                    else    showToastError(data.message)

                    },
                    error: function(response)
                {
                    $('#loading1').hide()

                   var errorResponse=JSON.parse(response.responseText)
                   showToastError(errorResponse.message)


                }
                })

        }


        function sorting()
    {
   var order=$('#sortby-select').val();
   var finalValue=order.split("#")
   orderByInfo.orderby=finalValue[0]
   orderByInfo.orderType=finalValue[1]
   getFilter(1)

    }
    
    function itemTypeFilter()
    {
   var order=$('#itemtype-select').val();
    status=order
   getFilter(1)

    }


        function appendPagination(currentPage,count)
    {
        var fd="";
        if (count >= 1) { 
            fd=fd+' <ul class="pagination pagination-rounded justify-content-end mb-3">'; 

            if (currentPage > 1) {            
              fd=fd+'<li class="page-item"><a class="page-link" onclick="getFilter(1)" href="javascript: void(0);" aria-label="Previous"> <span aria-hidden="true">«</span><span class="sr-only">Previous</span></a></li>';
            }
            else{
                fd=fd+'<li class="page-item"><a class="page-link disabled" href="javascript: void(0);" aria-label="Previous"> <span aria-hidden="true">«</span><span class="sr-only">Previous</span></a></li>';
            }
          var i = 1;
          if (currentPage > 5) {
          i = +currentPage - 4;
          } 
         // if (i !== 1) { 
         //      fd=fd+'<a  class="btn medium disabled ui-state-default" href="javascript:;">...</a>';
         //  } 
                         
         // alert(fd);
          
         
            for (i; i<=count; i++) {
                if (currentPage == i) { 
                  fd=fd+'<li class="page-item active"><a class="page-link" href="javascript: void(0);">'+currentPage+'</a></li>';
                } else {
                    fd=fd+'<li class="page-item"><a class="page-link" onclick="getFilter('+i+')" href="javascript: void(0);">'+i+'</a></li>';
                }
                if (i == (+currentPage + 4)) {
                    fd=fd+'<a  class="btn medium disabled ui-state-default" href="javascript:;">...</a>';
                 break; } 
              }
         
          
            if (currentPage != count) {
                fd=fd+'<li class="page-item"><a class="page-link" onclick="getFilter('+count+')" href="javascript: void(0);" aria-label="Previous"> <span aria-hidden="true">»</span><span class="sr-only">Next</span></a></li>';
            } 
            else{
                fd=fd+'<li class="page-item"><a class="page-link disabled" href="javascript: void(0);" aria-label="Previous"> <span aria-hidden="true">»</span><span class="sr-only">Next</span></a></li>';
            } 
             
            fd=fd+'</ul>';  
        } 

       
           $("#append_pagination").html(fd)  
    }
  



    function deleteComp(id)
    {

        if( confirm('Are you sure you want to delete this?'))
        {
            $.ajax({
                type: 'POST',
                url: '<%-superadminpath%>company/delete',
                dataType: 'json',
                data: {'id':id},
                success: function (response) {
                    if (response.code == '200') {
                    showToastSuccess(response.message)
                      getFilter(currentPage)    
                                               }
                    else{
                        showToastError(response.message)
                    }
                },
                error :function(response)
                {
                    var errorResponse=JSON.parse(response.responseText)
                 showToastError(errorResponse.message)


                }
            });
        }
    }


   
    function compareCompany() 
    {
        var id = $('#selectCompany').val();
        var array = id.split(",");
        if(array.length == 1)
        {
            showToastError("Sorry! Minimum two restaurants are allowed to compare!");
            return false;
        }
        window.location.href="<%-superadminpath %>company/compare?array="+array
       
    }

    function statusChange(id,status)
    {
        var confirm1= (status=="1") ? "Disable" : "Enable"

        if( confirm('Are you sure you want to '+confirm1+' this?'))
        {
            $.ajax({
                type: 'POST',
                url: '<%-superadminpath%>company/status',
                dataType: 'json',
                data: {'id':id,'status':status},
                success: function (response) {
                    //alert(response.code)
                    if (response.code == '200') {
                        
                        showToastSuccess(response.message)

                        getFilter(currentPage)


                    }
                    else{
                        showToastError(response.message)
                    }
                },
                error :function(response)
                {
                    var errorResponse=JSON.parse(response.responseText)
                 showToastError(errorResponse.message)

                }
            });
        }
    }



    getFilter(1)


   
    
</script>